var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},DPInitial=function(){function t(){this.settings={},this.store={},this.nodes={}}return t}(),DPMethods=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getValue=function(){var t,e;return e=parseInt(this.store.currentIndex,10),e>-1?(t=this.data[e].value,"function"==typeof t&&(t=t())):t=this.store.value,t},e.prototype.setValue=function(t){return this.store.currentIndex=null,this.store.value=t,this.trigger("changeValue"),!0},e.prototype.setValueIndex=function(t){this.store.value=null,this.store.currentIndex=t,this.trigger("changeValue")},e.prototype.open=function(){this.nodes.menu.classList.add("open")},e.prototype.close=function(){this.nodes.menu.classList.remove("open")},e.prototype.listen=function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},e.prototype.unlisten=function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},e.prototype.trigger=function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,[this.getValue(),Array.prototype.slice.call(arguments,1)])},e}(DPInitial),DP=function(t){function e(e,n){t.call(this);var s=this;if(this.container=e,"undefined"==typeof n||"undefined"==typeof n.data)this.nodes.unit=this.container.getElementsByClassName("dp-unit")[0],this.nodes.span=this.container.getElementsByClassName("dp-span")[0],this.nodes.menu=this.container.getElementsByClassName("dp-menu")[0];else if(this.settings.valueReturnByFunction=n.valueReturnByFunction||!0,this.data=n.data,Array.isArray(this.data)){for(;this.container.hasChildNodes();)this.container.removeChild(this.container.lastChild);this.container.classList.add("dp-container"),this.nodes.unit=document.createElement("div"),this.nodes.unit.classList.add("dp-unit"),this.container.appendChild(this.nodes.unit),this.nodes.span=document.createElement("div"),this.nodes.span.classList.add("dp-span"),this.nodes.span.textContent=n.name,this.nodes.unit.appendChild(this.nodes.span),this.nodes.menu=document.createElement("ul"),this.nodes.menu.classList.add("dp-menu"),this.nodes.unit.appendChild(this.nodes.menu);var i;this.data.forEach(function(t,e){i=document.createElement("li"),i.classList.add("dp-item"),i.textContent=t.label,i.dataset.index=e,s.nodes.menu.appendChild(i)})}else console.error("Unsupported data type");document.addEventListener("click",function(t){var e=t.target;s.nodes.menu.classList.contains("open")&&!s.isDescendant(s.container,e)&&s.nodes.menu.classList.remove("open")}),this.nodes.span.addEventListener("click",function(){s.nodes.menu.classList.toggle("open")}),this.nodes.menu.addEventListener("click",function(t){var e=t.target;if(e.classList.contains("dp-item")){var n=parseInt(e.dataset.index,10);n>-1?s.setValueIndex(n):s.setValue(e.dataset.value),s.close()}})}return __extends(e,t),e.prototype.isDescendant=function(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1},e}(DPMethods);