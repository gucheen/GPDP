var DP=function(e,t){var n=this;if(n.container=e,"undefined"==typeof t||"undefined"==typeof t.data)n.unit=n.container.getElementsByClassName("dp-unit")[0],n.span=n.container.getElementsByClassName("dp-span")[0],n.menu=n.container.getElementsByClassName("dp-menu")[0];else if(n.valueReturnByFunction=t.valueReturnByFunction,n.data=t.data,Array.isArray(n.data)){n.container.innerHTML="",n.container.classList.add("dp-container"),n.unit=document.createElement("div"),n.unit.classList.add("dp-unit"),n.container.appendChild(n.unit),n.span=document.createElement("div"),n.span.classList.add("dp-span"),n.span.textContent=t.name,n.unit.appendChild(n.span),n.menu=document.createElement("ul"),n.menu.classList.add("dp-menu"),n.unit.appendChild(n.menu);var a;n.data.map(function(e,t){a=document.createElement("li"),a.classList.add("dp-item"),a.textContent=e.label,a.dataset.index=t,n.menu.appendChild(a)})}else console.error("Unsupported data type");return document.addEventListener("click",function(e){n.menu.classList.contains("open")&&!n.isDescendant(n.container,e.target)&&n.menu.classList.remove("open")}),n.span.addEventListener("click",function(e){n.menu.classList.toggle("open")}),n.menu.addEventListener("click",function(e){if(e.target.classList.contains("dp-item")){var t=parseInt(e.target.dataset.index,10);t>-1?n.setValueIndex(t):n.setValue(e.target.dataset.value),n.close()}}),this};DP.prototype.listen=function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},DP.prototype.unlisten=function(e,t){this._events=this._events||{},e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},DP.prototype.trigger=function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,[this.getValue(),Array.prototype.slice.call(arguments,1)])},DP.prototype.getValue=function(){var e,t;return t=parseInt(this.container.dataset.index,10),t>-1?(e=this.data[t].value,"function"==typeof e&&(e=e())):e=this.container.dataset.value,e},DP.prototype.setValue=function(e){return this.container.dataset.index=null,this.container.dataset.value=e,this.trigger("changeValue"),!0},DP.prototype.setValueIndex=function(e){this.container.dataset.value=null,this.container.dataset.index=e,this.trigger("changeValue")},DP.prototype.open=function(){this.menu.classList.add("open")},DP.prototype.close=function(){this.menu.classList.remove("open")},DP.prototype.isDescendant=function(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1};